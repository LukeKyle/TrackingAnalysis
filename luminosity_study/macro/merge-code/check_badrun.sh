#!/bin/bash

# List of directories
directories="52779 53076 53256 53339 53367 53391 53482 53531 53559 53584 53592 53619 53624 53668 52782 52847 52679 52752 53212 53411 53456 53490 53516 53519 53625 53667 53680 53717 52785 52890 52717 53195 53242 53260 53336 53337 53403 53450 53453 53511 53514 53530 53594 53639 53640 53343 53365 53393 53410 53457 53536 53596 53652 53027 53028 52850 53081 53218 53223 53240 53408 53435 53552 53553 53580 53600 53714 52873 52874 52889 53166 52754 53200 53211 53226 53350 53428 53472 53483 53494 53540 53556 53582 53595 53618 53669 53713 53736 53171 52857 53202 53247 53342 53392 53426 53464 53534 53638 53648 53705 53724 53066 53167 53246 53253 52805 53347 53366 53533 53583 53681 53722 53079 53170 52819 53579 53671 52912 52719 52781 52814 52816 53054 53065 53073 53165 52586 53174 53199 53210 53386 53470 53512 53515 53539 53550 53623 53672 53719 52760 53219 53257 53368 53388 53404 53466 53510 53518 53538 53554 53558 53586 52917 53055 53070 53169 52680 53224 53254 53346 53389 53398 53491 53492 53493 53513 53578 53620 Runnumber 53773 53047 52751 52910 53227 53252 53289 53332 53333 53349 53383 53405 53537 53591 53712 problem-runs 52851 53029 52845 53172 53194 53213 53220 52749 53249 53290 53469 53571 53581 53601 53603 53707 53058 53068 52848 53048 53385 53397 53429 53451 53473 53593 53670 53686 53709 53710 53735 52724 52844 52858 52876 52878 53083 53291 53379 53423 53436 53455 53532 53551 53630"

missing_evt_files=()
other_files=()

# Loop through each directory
for dir in $directories; do
    if [ -d "$dir" ] && [ -f "$dir/condor-gl10.out" ]; then
        # Extract the target line
        line=$(tail -n 2 "$dir/condor-gl10.out" | head -n 1)

        # Check the condition
        if [[ "$line" =~ ^Fun4AllServer::run\ -\ processing\ event\ 10444094 ]]; then
            missing_evt_files+=("$dir")
        else
	    last_line=$(tail -n 1 "$dir/condor-gl10.out")
	    if [[ "$last_line" =~ ^Fun4AllServer::run\ -\ processing\ event\ 10444094 ]]; then
	    missing_evt_files+=("$dir")
	    else
            other_files+=("$dir")
	    fi
        fi
    else
        echo "Directory $dir: condor-gl10.out not found or directory does not exist."
    fi
done

# Print the results
echo "Missing evt files: ${missing_evt_files[*]}" | sed 's/ /, /g'
echo "Other files: ${other_files[*]}" | sed 's/ /, /g'

echo "Last lines of other files:"
for dir in "${other_files[@]}"; do
    last_line=$(tail -n 1 "$dir/condor-gl10.out")
    echo "Directory $dir: $last_line"
done
